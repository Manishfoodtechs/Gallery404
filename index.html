
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Gallery 404</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="jquery.min.js"></script>
        <script src="init.js"></script>
        <script src="ParticleEngine.js"></script>
        <script src="ParticleEngineExamples.js"></script>
        <script src="three.min.js"></script>
        <script src="PointerLockControls.js"></script>
        <script src="loaders/BinaryLoader.js"></script>
        <script src="loaders/OBJMTLLoader.js"></script>
        <script src="loaders/MTLLoader.js"></script>
        <script src="loaders/ColladaLoader.js"></script>
    </head>

    <body>


        <div id="blocker">
            <div id="instructions">
                <span style="font-size:46px">Welcome to <font color="#e30bb7">Gallery 404,</font><br /> <span style="font-size:28px">A fully interactive, explorable,<br />web-based 3D art gallery.</span><br /> <br /><span style="font-size:18px">Click anywhere on the screen to start.<br/>(W, A, S, D, E, Q = Move, MOUSE = Look) </span>
                <br />
                <br />
            </div>
        </div>
        <div id ="controls">
            <div id="q" class="key">Q<br /><span class="key-info">Turn Left</span></div><div id="w" class="key">W<br /><span class="key-info">Forward</span></div><div id="e" class="key">E<br /><span class="key-info">Turn Right</span></div> <br />
            <div id="a" class="key">A<br /><span class="key-info">Move Left</span></div><div id="s" class="key">S<br /><span class="key-info">Backwards</span></div><div id="d" class="key">D<br /><span class="key-info">Move Right</span></div>
        </div>






        <script>

            var camera, scene, renderer;
            var geometry, material, mesh;
            var controls,time = Date.now();
            var objects = [];
            var ray;
            var blocker = document.getElementById( 'blocker' );
            var instructions = document.getElementById( 'instructions' );
            var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;
            if ( havePointerLock ) {
                var element = document.body;
                var pointerlockchange = function ( event ) {
                    if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {
                        controls.enabled = true;
                        blocker.style.display = 'none';
                    } else {
                        controls.enabled = false;
                        blocker.style.display = '-webkit-box';
                        blocker.style.display = '-moz-box';
                        blocker.style.display = 'box';
                        instructions.style.display = '';
                    }
                }

                var pointerlockerror = function ( event ) {
                    instructions.style.display = '';
                }

                // Hook pointer lock state change events
                document.addEventListener( 'pointerlockchange', pointerlockchange, false );
                document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
                document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );
                document.addEventListener( 'pointerlockerror', pointerlockerror, false );
                document.addEventListener( 'mozpointerlockerror', pointerlockerror, false );
                document.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );
                instructions.addEventListener( 'click', function ( event ) {
                    instructions.style.display = 'none';
                    // Ask the browser to lock the pointer
                    element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;
                    if ( /Firefox/i.test( navigator.userAgent ) ) {
                        var fullscreenchange = function ( event ) {
                            if ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element ) {
                                document.removeEventListener( 'fullscreenchange', fullscreenchange );
                                document.removeEventListener( 'mozfullscreenchange', fullscreenchange );
                                element.requestPointerLock();
                            }
                        }
                        document.addEventListener( 'fullscreenchange', fullscreenchange, false );
                        document.addEventListener( 'mozfullscreenchange', fullscreenchange, false );
                        element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;
                        element.requestFullscreen();
                    } else {
                        element.requestPointerLock();
                    }
                }, false );
            } else {
                  instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API, sorry';
            }

            function init() {


                            /////////////////////////////////////
                            //** -- ENVIRONMENT ELEMENTS -- **//
                            ///////////////////////////////////

                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000 );
                scene = new THREE.Scene();
                scene.fog = new THREE.Fog( 0xffffff, 0, 750 );
                var light = new THREE.DirectionalLight( 0xffffff, 1.5 );
                light.position.set( 1, 1, 1 );
                scene.add( light );
                var light = new THREE.DirectionalLight( 0xffffff, 0.75 );
                light.position.set( -1, - 0.5, -1 );
                scene.add( light );
                controls = new THREE.PointerLockControls( camera );
                scene.add( controls.getObject() );
                ray = new THREE.Raycaster();
                ray.ray.direction.set( 0, -1, 0 );


                geometry = new THREE.PlaneGeometry( 1250, 1250, 100, 100 );
                geometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );

                var material = new THREE.MeshLambertMaterial({
                map: THREE.ImageUtils.loadTexture('textures/marble.png')
                });
                mesh = new THREE.Mesh( geometry, material );
                scene.add( mesh );

                              
                                /////////////////////////////////
                                //** -- ART OBJECT MODELS -- **//
                                /////////////////////////////////


                   //------------------- BRILLO BOXES -----------------//
                   var materials = [
                   new THREE.MeshLambertMaterial({
                       map: THREE.ImageUtils.loadTexture('textures/BrilloBox.png')
                   }),
                   new THREE.MeshLambertMaterial({
                       map: THREE.ImageUtils.loadTexture('textures/BrilloBox.png')
                   }),
                   new THREE.MeshLambertMaterial({
                       map: THREE.ImageUtils.loadTexture('textures/BrilloBoxTop.png')
                   }),
                   new THREE.MeshLambertMaterial({
                       map: THREE.ImageUtils.loadTexture('textures/BrilloBoxTop.png')
                   }),
                   new THREE.MeshLambertMaterial({
                       map: THREE.ImageUtils.loadTexture('textures/BrilloBox.png')
                   }),
                   new THREE.MeshLambertMaterial({
                       map: THREE.ImageUtils.loadTexture('textures/BrilloBox.png')
                   })
                ];
                   brillo = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo.position.y = 25;
                   brillo.position.z = 400;
                   brillo.position.x = -200;
                   scene.add( brillo );
                   objects.push ( brillo );

                   brillo2 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo2.position.y = 50;
                   brillo2.position.z = 400;
                   brillo2.position.x = -250;
                   scene.add( brillo2 );
                   objects.push ( brillo2 );

                   brillo3 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo3.position.y = 75;
                   brillo3.position.z = 375;
                   brillo3.position.x = -320;
                   scene.add( brillo3 );
                   objects.push ( brillo3 );

                   brillo4 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo4.position.y = 100;
                   brillo4.position.z = 200;
                   brillo4.position.x = -475;
                   scene.add( brillo4 );
                   objects.push ( brillo4 );

                   brillo5 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo5.position.y = 120;
                   brillo5.position.z = 530;
                   brillo5.position.x = -360;
                   scene.add( brillo5 );
                   objects.push ( brillo5 );

                   brillo6 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo6.position.y = 150;
                   brillo6.position.z = 450;
                   brillo6.position.x = -260;
                   scene.add( brillo6 );
                   objects.push ( brillo6 );

                   brillo7 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo7.position.y = 170;
                   brillo7.position.z = 550;
                   brillo7.position.x = -430;
                   scene.add( brillo7 );
                   objects.push ( brillo7 );

                   brillo8 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo8.position.y = 150;
                   brillo8.position.z = 350;
                   brillo8.position.x = -530;
                   scene.add( brillo8 );
                   objects.push ( brillo8 );

                   brillo9 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo9.position.y = 100;
                   brillo9.position.z = 300;
                   brillo9.position.x = -400;
                   scene.add( brillo9 );
                   objects.push ( brillo9 );

                   brillo10 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo10.position.y = 55;
                   brillo10.position.z = 460;
                   brillo10.position.x = -370;
                   scene.add( brillo10 );
                   objects.push ( brillo10 );

                   brillo11 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo11.position.y = 300;
                   brillo11.position.z = 425;
                   brillo11.position.x = -320;
                   scene.add( brillo11 );
                   objects.push ( brillo11 );

                   brillo12 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo12.position.y = 125;
                   brillo12.position.z = 370;
                   brillo12.position.x = -250;
                   scene.add( brillo12 );
                   objects.push ( brillo12 );

                   brillo13 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo13.position.y = 250;
                   brillo13.position.z = 450;
                   brillo13.position.x = -300;
                   scene.add( brillo13 );
                   objects.push ( brillo13 );

                   brillo14 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo14.position.y = 175;
                   brillo14.position.z = 320;
                   brillo14.position.x = -400;
                   scene.add( brillo14 );
                   objects.push ( brillo14 );

                   brillo15 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo15.position.y = 250;
                   brillo15.position.z = 500;
                   brillo15.position.x = -260;
                   scene.add( brillo15 );
                   objects.push ( brillo15 );

                   brillo16 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo16.position.y = 200;
                   brillo16.position.z = 420;
                   brillo16.position.x = -270;
                   scene.add( brillo16 );
                   objects.push ( brillo16 );

                   brillo17 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo17.position.y = 270;
                   brillo17.position.z = 300;
                   brillo17.position.x = -250;
                   scene.add( brillo17 );
                   objects.push ( brillo17 );

                   brillo18 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo18.position.y = 250;
                   brillo18.position.z = 350;
                   brillo18.position.x = -500;
                   scene.add( brillo18 );
                   objects.push ( brillo18 );

                   brillo19 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo19.position.y = 300;
                   brillo19.position.z = 300;
                   brillo19.position.x = -400;
                   scene.add( brillo19 );
                   objects.push ( brillo19 );

                   brillo20 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo20.position.y = 375;
                   brillo20.position.z = 400;
                   brillo20.position.x = -350;
                   scene.add( brillo20 );
                   objects.push ( brillo20 );

                   brillo21 = new THREE.Mesh(
                        new THREE.CubeGeometry( 40,40,40 ),
                        new THREE.MeshFaceMaterial( materials ) );
                   brillo21.position.y = 350;
                   brillo21.position.z = 425;
                   brillo21.position.x = -300;
                   scene.add( brillo21 );
                   objects.push ( brillo21 );
                   
                   bonusPlatform = new THREE.CubeGeometry( 120, 10, 120 );
                   material = new THREE.MeshLambertMaterial( {ambient: 0xffffff} );

                   var bonusMesh = new THREE.Mesh( bonusPlatform, material );
                   bonusMesh.position.x = -300;
                   bonusMesh.position.y = 400;
                   bonusMesh.position.z = 500;
                   scene.add( bonusMesh );
                   objects.push( bonusMesh );

                var brilloMaterials = [
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshLambertMaterial({
                    ambient: 0xffffff,
                    map: THREE.ImageUtils.loadTexture( 'textures/warholCard.png' ) }),
                new THREE.MeshBasicMaterial( {} )
                ];

                brilloLabel = new THREE.Mesh(
                new THREE.CubeGeometry( 10, 5, 0.5),
                new THREE.MeshFaceMaterial( brilloMaterials ) );
                scene.add( brilloLabel );
                brilloLabel.position.y = 32.5;
                brilloLabel.position.x = -220;
                brilloLabel.position.z = 250;
                brilloLabel.rotation.y = 90;



                //------------------- DUCHAMP URINAL -----------------//

                var loader = new THREE.OBJMTLLoader();
                loader.addEventListener( 'load', function ( event ) {
                    var object = event.content;
                    object.position.y =  400;
                    object.position.x = -300;
                    object.position.z = 525;
                    object.rotation.x = -Math.PI / 2; 
                    object.rotation.z = -Math.PI; 
                    object.scale.x = .8;
                    object.scale.y = .8;
                    object.scale.z = .8;
                    scene.add( object );
                });
                loader.load( 'models/Rmutt.obj', 'models/Rmutt.mtl' );

                var duchampMaterials = [
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshLambertMaterial({
                    ambient: 0xffffff,
                    map: THREE.ImageUtils.loadTexture( 'textures/duchampCard.png' ) }),
                new THREE.MeshBasicMaterial( {} )
                ];

                duchampLabel = new THREE.Mesh(
                new THREE.CubeGeometry( 10, 5, 0.5),
                new THREE.MeshFaceMaterial( duchampMaterials ) );
                scene.add( duchampLabel );
                duchampLabel.position.y = 442.5;
                duchampLabel.position.x = -320;
                duchampLabel.position.z = 500;
                duchampLabel.rotation.y = -Math.PI; 

              
                //------------------- ENDLESS TOWER -----------------//

                var loader = new THREE.ColladaLoader();
                var endlessTexture = new THREE.MeshLambertMaterial({
                    map: THREE.ImageUtils.loadTexture( 'textures/endlessTexture.png' ) 
                });
                loader.load('models/endless.dae', function (result) {
                    scene.add(result.scene);
                    result.scene.position.y =  -10;
                    result.scene.position.x =  -100;
                    // result.scene.position.x =  0;
                    // result.scene.position.z =  300;
                    result.scene.scale.x = .3;
                    result.scene.scale.y = .3;
                    result.scene.scale.z = .3;
                    result.scene.rotation.x = -Math.PI / 2;                   
                });

                var endlessMaterials = [
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshLambertMaterial({
                    ambient: 0xffffff,
                    map: THREE.ImageUtils.loadTexture( 'textures/endlessCard.png' ) }),
                new THREE.MeshBasicMaterial( {} )
                ];

                endlessLabel = new THREE.Mesh(
                new THREE.CubeGeometry( 10, 5, 0.5),
                new THREE.MeshFaceMaterial( endlessMaterials ) );
                scene.add( endlessLabel );
                endlessLabel.position.y = 32.5;
                endlessLabel.position.x = 500;
                endlessLabel.position.z = -100;
                endlessLabel.rotation.y = -Math.PI / 2;  



                //------------------- KOONS DOG -----------------//

                var jsonLoader = new THREE.JSONLoader();
                jsonLoader.load( "models/koons.js", addModelToScene );


                function addModelToScene( geometry, materials ) {
                var path = "textures/cube/SwedishRoyalCastle/";
                var format = '.jpg';
                var urls = [
                        path + 'px' + format, path + 'nx' + format,
                        path + 'py' + format, path + 'ny' + format,
                        path + 'pz' + format, path + 'nz' + format
                    ];
                var reflectionCube = THREE.ImageUtils.loadTextureCube( urls );
                reflectionCube.format = THREE.RGBFormat;
                var refractionCube = new THREE.Texture( reflectionCube.image, new THREE.CubeRefractionMapping() );
                refractionCube.format = THREE.RGBFormat;
                var material = new THREE.MeshLambertMaterial( { color: 0xffee00, ambient: 0x996600,  envMap: reflectionCube, combine: THREE.MixOperation, reflectivity: 0.75} );

                koons = new THREE.Mesh( geometry, material );

                koons.scale.x = 10;
                koons.scale.y = 10;
                koons.scale.z = 10;
                koons.position.x = 5;
                koons.position.y = 15;
                koons.position.z = 150;
                scene.add(koons);

                function deflate() {
                setInterval(function() {
                    if (koons.scale.x > 10 ) {
                        koons.scale.x -= .1; 
                        koons.scale.y -=.025;                    
                    }
                    else  if (koons.scale.x < 10){
                        clearInterval();
                        inflate();
                    }
                }, 0050);
                }
                function inflate() {
                setInterval(function() {
                    if (koons.scale.x < 20 ) {
                        koons.scale.x += .1;
                        koons.scale.y += .025;
                    }
                    else if (koons.scale.x > 20){
                        clearInterval();
                        deflate();
                    }
                }, 0050);
                }
                inflate();
                }

                koonsPlatform = new THREE.CubeGeometry( 120, 10, 120 );

                var koonsMaterials = [
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshBasicMaterial( {} ),
                new THREE.MeshLambertMaterial({
                    ambient: 0xffffff,
                    map: THREE.ImageUtils.loadTexture( 'textures/koonsCard.png' ) }),
                new THREE.MeshBasicMaterial( {} )
                ];
                koonsLabel = new THREE.Mesh(
                new THREE.CubeGeometry( 10, 5, 0.5),
                new THREE.MeshFaceMaterial( koonsMaterials ) );
                scene.add( koonsLabel );
                koonsLabel.position.y = 32.5;
                koonsLabel.position.x = 45;
                koonsLabel.position.z = -279.5;

                material = new THREE.MeshBasicMaterial( {} );
                var mesh = new THREE.Mesh( koonsPlatform, material );
                mesh.position.x = -10;
                mesh.position.y = 10;
                mesh.position.z = -340;
                mesh.rotation.y = 0


                scene.add(mesh); 
                objects.push( mesh );


                //------------------- KRUGER WALL -----------------//

                var krugerMaterials = [
                new THREE.MeshBasicMaterial( { } ),
                new THREE.MeshBasicMaterial( { } ),
                new THREE.MeshBasicMaterial( { } ),
                new THREE.MeshBasicMaterial( { } ),
                new THREE.MeshLambertMaterial({ }),
                new THREE.MeshBasicMaterial( { 
                    ambient: 0xffffff,
                    map: THREE.ImageUtils.loadTexture( 'textures/kruger1.png' )} )
                ];

                krugerWall = new THREE.Mesh(
                new THREE.CubeGeometry( 400, 600, 20),
                new THREE.MeshFaceMaterial( krugerMaterials ) );
                scene.add( krugerWall );
                krugerWall.position.y = 300;
                krugerWall.position.x = 435;
                krugerWall.position.z = 500;
                krugerWall.rotation.y = -125  

                setTimeout(function(){
                    var krugerMaterials = [
                        new THREE.MeshBasicMaterial( { } ),
                        new THREE.MeshBasicMaterial( { } ),
                        new THREE.MeshBasicMaterial( { } ),
                        new THREE.MeshBasicMaterial( { } ),
                        new THREE.MeshLambertMaterial({ }),
                        new THREE.MeshBasicMaterial( { 
                            ambient: 0xffffff,
                            map: THREE.ImageUtils.loadTexture( 'textures/kruger2.png' )} )
                        ];                  
                },10000);


                // var loader = new THREE.OBJMTLLoader();
                // loader.addEventListener( 'load', function ( event ) {
                //     var object = event.content;
                //     object.position.y =  0;
                //     object.position.x = 200;
                //     scene.add( object );
                // });
                // loader.load( 'models/male02.obj', 'models/male02.mtl' );
                }


                //////////////////////////////
                //2** --    ANIMATION --   **//
                //////////////////////////////


            function animate() {
                requestAnimationFrame( animate );
                controls.isOnObject( false );
                ray.ray.origin.copy( controls.getObject().position );
                ray.ray.origin.y -= 10;  
                ray.ray.origin.z -= 10;  
                var intersections = ray.intersectObjects( objects );
                if ( intersections.length > 0 ) {
                    var distance = intersections[ 0 ].distance;
                    if ( distance > 0 && distance < 10 ) {
                        controls.isOnObject( true );
                    }
                }
                controls.update( Date.now() - time );
                renderer.render( scene, camera );
                time = Date.now();
            }



                //////////////////////////////////
                //** --    WINDOW EVENTS --   **//
                //////////////////////////////////

            renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );

            document.body.appendChild( renderer.domElement );
            window.addEventListener( 'resize', onWindowResize, false );


            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
            }

            init();
            animate();

        </script>
    </body>
</html>
