
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Gallery 404</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="three.min.js"></script>
        <script src="PointerLockControls.js"></script>
        <script src="loaders/BinaryLoader.js"></script>
        <script src="loaders/OBJMTLLoader.js"></script>
        <script src="loaders/MTLLoader.js"></script>
        <script src="loaders/ColladaLoader.js"></script>
        <script src="jquery.min.js"></script>
        <script src="init.js"></script>
    </head>

    <body>


        <div id="blocker">
            <div id="instructions">
                <span style="font-size:46px">Welcome to <font color="#e30bb7">Gallery 404,</font><br /> <span style="font-size:28px">A fully interactive, explorable,<br />web-based 3D art gallery.</span><br /> <br /><span style="font-size:18px">Click anywhere on the screen to start.<br/>(W, A, S, D, E, Q = Move, MOUSE = Look) </span>
                <br />
                <br />
            </div>
        </div>
        <div id ="controls">
            <div id="q" class="key">Q<br /><span class="key-info">Turn Left</span></div><div id="w" class="key">W<br /><span class="key-info">Forward</span></div><div id="e" class="key">E<br /><span class="key-info">Turn Right</span></div> <br />
            <div id="a" class="key">A<br /><span class="key-info">Move Left</span></div><div id="s" class="key">S<br /><span class="key-info">Backwards</span></div><div id="d" class="key">D<br /><span class="key-info">Move Right</span></div>
        </div>






        <script>

            var camera, scene, renderer;
            var geometry, material, mesh;
            var controls,time = Date.now();
            var objects = [];
            var ray;
            var blocker = document.getElementById( 'blocker' );
            var instructions = document.getElementById( 'instructions' );
            var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;
            if ( havePointerLock ) {
                var element = document.body;
                var pointerlockchange = function ( event ) {
                    if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {
                        controls.enabled = true;
                        blocker.style.display = 'none';
                    } else {
                        controls.enabled = false;
                        blocker.style.display = '-webkit-box';
                        blocker.style.display = '-moz-box';
                        blocker.style.display = 'box';
                        instructions.style.display = '';
                    }
                }

                var pointerlockerror = function ( event ) {
                    instructions.style.display = '';
                }

                // Hook pointer lock state change events
                document.addEventListener( 'pointerlockchange', pointerlockchange, false );
                document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
                document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );
                document.addEventListener( 'pointerlockerror', pointerlockerror, false );
                document.addEventListener( 'mozpointerlockerror', pointerlockerror, false );
                document.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );
                instructions.addEventListener( 'click', function ( event ) {
                    instructions.style.display = 'none';
                    // Ask the browser to lock the pointer
                    element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;
                    if ( /Firefox/i.test( navigator.userAgent ) ) {
                        var fullscreenchange = function ( event ) {
                            if ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element ) {
                                document.removeEventListener( 'fullscreenchange', fullscreenchange );
                                document.removeEventListener( 'mozfullscreenchange', fullscreenchange );
                                element.requestPointerLock();
                            }
                        }
                        document.addEventListener( 'fullscreenchange', fullscreenchange, false );
                        document.addEventListener( 'mozfullscreenchange', fullscreenchange, false );
                        element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;
                        element.requestFullscreen();
                    } else {
                        element.requestPointerLock();
                    }
                }, false );
            } else {
                  instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API, sorry';
            }
            init();
            animate();

            function init() {

                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000 );
                scene = new THREE.Scene();
                scene.fog = new THREE.Fog( 0xffffff, 0, 1050 );
                var light = new THREE.DirectionalLight( 0xffffff, 1.5 );
                light.position.set( 1, 1, 1 );
                scene.add( light );
                var light = new THREE.DirectionalLight( 0xffffff, 0.75 );
                light.position.set( -1, - 0.5, -1 );
                scene.add( light );
                controls = new THREE.PointerLockControls( camera );
                scene.add( controls.getObject() );
                ray = new THREE.Raycaster();
                ray.ray.direction.set( 0, -2, 0 );

                // floor

                geometry = new THREE.PlaneGeometry( 2000, 2000, 100, 100 );
                geometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );
                for ( var i = 0, l = geometry.vertices.length; i < l; i ++ ) {
                    var vertex = geometry.vertices[ i ];
                    vertex.x += 10;
                    vertex.y += 2;
                    vertex.z += 10;
                }
                for ( var i = 0, l = geometry.faces.length; i < l; i ++ ) {
                    var face = geometry.faces[ i ];
                    face.vertexColors[ 0 ] = new THREE.Color(0xffffff);
                    face.vertexColors[ 1 ] = new THREE.Color(0xdddddd);
                    face.vertexColors[ 2 ] = new THREE.Color(0xffffff);
                    face.vertexColors[ 3 ] = new THREE.Color(0xdddddd);
                }

                var material = new THREE.MeshLambertMaterial({
                map: THREE.ImageUtils.loadTexture('textures/marble.png')
                });

                mesh = new THREE.Mesh( geometry, material );
                scene.add( mesh );

                // objects

                geometry = new THREE.CubeGeometry( 80, 100, 5 );

                //////////////////////////////////
                //** -- JSON OBJECT LOADER -- **//
                //////////////////////////////////

                // KOONS BALLOON DOG

                koonsPlatform = new THREE.CubeGeometry( 20, 10, 200 );
                var platformMaterial = new THREE.MeshLambertMaterial({
                    color: 0xd2121d
                });

                var mesh = new THREE.Mesh( koonsPlatform, platformMaterial );
                mesh.position.x = -500;
                mesh.position.y = 10;
                mesh.position.z = 150;
                mesh.rotation.x = 150;
                scene.add( mesh );
                objects.push( mesh );
    
                var loader = new THREE.ColladaLoader();
                loader.load('models/tatlin.dae', function (result) {
                    scene.add(result.scene);
                    result.scene.position.y =  00;
                    result.scene.position.x = 100;
                    // result.scene.position.x =  0;
                    result.scene.rotation.x = -900;
                    // result.scene.rotation.y = 25.1;
                    // result.scene.position.z =  300;
                    result.scene.scale.x = .1;
                    result.scene.scale.y = .1;
                    result.scene.scale.z = .1;         

                });                

                renderer = new THREE.WebGLRenderer();
                renderer.setSize( window.innerWidth, window.innerHeight );

                document.body.appendChild( renderer.domElement );
                window.addEventListener( 'resize', onWindowResize, false );

                // var loader = new THREE.ColladaLoader();
                // loader.load('models/tatlin.dae', function (result) {
                //   scene.add(result.scene);
                // result.scene.position.y =  0;
                // result.scene.position.x =  0;
                // result.scene.rotation.x = -900;
                // result.scene.position.z =  300;
                   
                // });

                // var loader = new THREE.OBJMTLLoader();
                // loader.addEventListener( 'load', function ( event ) {
                //     var object = event.content;
                //     object.position.y =  0;
                //     object.position.x = 200;
                //     scene.add( object );
                // });
                // loader.load( 'models/male02.obj', 'models/male02.mtl' );
                }

                function onWindowResize() {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize( window.innerWidth, window.innerHeight );
                }

                function animate() {
                    requestAnimationFrame( animate );
                    controls.isOnObject( false );
                    ray.ray.origin.copy( controls.getObject().position );
                    ray.ray.origin.y -= 10;  

                    var intersections = ray.intersectObjects( objects );
                    if ( intersections.length > 0 ) {
                        var distance = intersections[ 0 ].distance;
                        if ( distance > 0 && distance < 10 ) {
                            controls.isOnObject( true );
                        }
                    }
                    controls.update( Date.now() - time );
                    renderer.render( scene, camera );
                    time = Date.now();
                }

        </script>
    </body>
</html>
